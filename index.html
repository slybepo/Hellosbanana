<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forum - Nexaverse VR</title>
<style>
  body {
    background: linear-gradient(145deg, #1a0036, #0d001a);
    color: white;
    font-family: Arial, sans-serif;
  }
  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    padding: 1rem;
    background-color: #2e004f;
    color: white;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .forum-container {
    margin-top: 4rem;
    padding: 2rem;
  }
  .post {
    background: #2e004f;
    margin: 1rem 0;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.2);
  }
  .post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .delete-btn, .pin-btn {
    cursor: pointer;
    color: #ff4d4d;
    background: none;
    border: none;
    font-size: 0.8rem;
    text-decoration: underline;
  }
</style>
</head>
<body>

<div class="navbar">
  <span id="user-name">Fetching user...</span>
</div>

<div class="forum-container">
  <h2>Forum</h2>
  <button id="add-post" style="display: none;">Add Post</button>
  <div id="posts">
    <!-- Posts dynamically added here -->
  </div>
</div>

<script src="auth.js"></script>
<script>
  async function setupForum() {
    const { user, roles } = await checkAuth();
    if (!user) return;

    document.getElementById("user-name").innerText = user.name;

    if (roles.includes("moderator")) {
      document.getElementById("add-post").style.display = "block";
      document.getElementById("add-post").addEventListener("click", () => {
        const postContent = prompt("Enter post content:");
        if (postContent) {
          addPost(postContent);
        }
      });
    }

    loadPosts(roles);
  }

  async function loadPosts(roles) {
    // Mock data for posts
    const posts = [
      { id: 1, content: "Welcome to the forum!", pinned: true },
      { id: 2, content: "Discuss VR games here.", pinned: false }
    ];

    const postsContainer = document.getElementById("posts");
    postsContainer.innerHTML = "";

    posts.forEach(post => {
      const postEl = document.createElement("div");
      postEl.className = "post";

      const formattedContent = post.content.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

      postEl.innerHTML = `
        <div class="post-header">
          <span>${formattedContent}</span>
          ${roles.includes("moderator") ? `
            <button class="pin-btn" onclick="pinPost(${post.id})">Pin</button>
            <button class="delete-btn" onclick="deletePost(${post.id})">Delete</button>
          ` : ""}
        </div>
      `;

      postsContainer.appendChild(postEl);
    });
  }

  async function addPost(content) {
    alert("Post added: " + content); // Mock adding post logic
  }

  async function pinPost(postId) {
    alert("Post pinned: " + postId); // Mock pinning logic
  }

  async function deletePost(postId) {
    alert("Post deleted: " + postId); // Mock deleting logic
  }

  setupForum();
</script>

</body>
</html>
